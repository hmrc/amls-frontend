@*
 * Copyright 2019 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import include._
@import models.notifications._
@import utils.ContactTypeHelper
@import config.{ ApplicationConfig}

@(businessName: String, currentApplicationNotifications: Seq[NotificationRow], previousApplicationNotifications: Seq[NotificationRow] = Seq())(implicit request: Request[_],m:Messages, lang: Lang, appConfig: ApplicationConfig)

@header = {
    @components.back_link()
    @heading("notifications.header", "summary.status")
}

@notification_table(
    id: String,
    notifications: Seq[NotificationRow]
) = {
    <div class="full-width">
        <table id=@id class="notifications">
            <thead>
            <tr>
                <th scope="col" class="message-unread"><span class="visuallyhidden">Status</span></th>
                <th scope="col">@Messages("notifications.table.header.subject")</th>
                <th class="message-type" scope="col">@Messages("notifications.table.header.type")</th>
                <th scope="col" class="message-date">@Messages("notifications.table.header.date")</th>
            </tr>
            </thead>
            <tbody>
            @notifications.map { comms =>
            <tr class="@if(!comms.isRead){unread}">
                <td>@if(!comms.isRead){<span class="circle"></span><span class="visuallyhidden">Unread</span>}else{<span class="visuallyhidden">Read</span>}</td>
                <td><a href="@controllers.routes.NotificationController.messageDetails(comms._id.id, ContactTypeHelper.getContactType(comms.status, comms.contactType, comms.variation), comms.amlsRegistrationNumber, comms.templatePackageVersion)">@Messages(comms.subject)</a></td>
                <td>@Messages(comms.notificationType)</td>
                <td>@comms.dateReceived</td>
            </tr>
            }
            </tbody>
        </table>
    </div>
}

@notifications_your_messages(
    title = Messages("notifications.header"),
    heading = header
) {

    <div class="grid-layout">
        <div class="grid-layout__column grid-layout__column--2-3">
            <p>
                <span id="your-business" class="heading-small">@Messages("notifications.title")</span>
                <br />
                <span id="business-name">@businessName</span>
            </p>
        </div>
    </div>

    @notification_table("current-application-notifications", currentApplicationNotifications)

    @if(previousApplicationNotifications.length > 0) {
        <div class="grid-layout">
            <div class="grid-layout__column grid-layout__column--2-3">
                <p>
                    <span id="previous-reg-title" class="heading-small">@Messages("notifications.previousReg")</span>
                </p>
            </div>
        </div>

        @notification_table("previous-application-notifications", previousApplicationNotifications)
    }

}
